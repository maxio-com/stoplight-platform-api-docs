# This workflow deploys legacy portal to staging/prod
name: Deploy legacy portal
on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Environment"
        required: true
        default: "staging"
        type: choice
        options:
          - staging
          - prod
env:
  AWS_REGION: us-west-2
permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main repository
        uses: actions/checkout@v3
      - name: Build portal
        shell: bash
        env:
          APIMATIC_API_KEY: ${{ secrets.APIMATIC_API_KEY }}
        run: |
          new_portal_url='N/A'
          echo "Environment is: ${{ github.event.inputs.environment }}"
          if [ "${{ github.event.inputs.environment }}"="staging" ]; then
            echo "Using staging URL"
            new_portal_url='https://staging-developers.maxio.com/main/index.html'
          fi
          if [ "${{ github.event.inputs.environment }}"="prod" ]; then
            echo "Using prod URL"
            new_portal_url='https://prod-developers.maxio.com/'
          fi
          ./scripts/build_legacy_portal.sh "$new_portal_url"
     
