title: Create Subscription
type: object
x-tags:
  - Subscriptions
properties:
  product_handle:
    type: string
    description: 'The API Handle of the product for which you are creating a subscription. Required, unless a `product_id` is given instead.'
  product_id:
    type: string
    description: 'The Product ID of the product for which you are creating a subscription. The product ID is not currently published, so we recommend using the API Handle instead.'
  product_price_point_handle:
    type: string
    description: The user-friendly API handle of a product's particular price point.
  product_price_point_id:
    type: string
    description: The ID of the particular price point on the product.
  coupon_code:
    type: string
    description: '(Optional) The coupon code of the coupon to apply '
  payment_collection_method:
    type: string
    description: (Optional) The type of payment collection to be used in the subscription.
    enum:
      - automatic
      - invoice
      - remittance
      - prepaid
  receives_invoice_emails:
    type: string
    description: '(Optional) Default: True - Whether or not this subscription is set to receive emails related to this subscription.'
  net_terms:
    type: string
    description: '(Optional) Default: null The number of days after renewal (on invoice billing) that a subscription is due. A value between 0 (due immediately) and 180.'
  customer_id:
    type: integer
    description: 'The ID of an existing customer within Chargify. Required, unless a `customer_reference` or a set of `customer_attributes` is given.'
  next_billing_at:
    type: string
    description: '(Optional) Set this attribute to a future date/time to sync imported subscriptions to your existing renewal schedule. See the notes on “Date/Time Format” in our [subscription import documentation](https://help.chargify.com/subscriptions/subscriptions-import.html). If you provide a next_billing_at timestamp that is in the future, no trial or initial charges will be applied when you create the subscription. In fact, no payment will be captured at all. The first payment will be captured, according to the prices defined by the product, near the time specified by next_billing_at. If you do not provide a value for next_billing_at, any trial and/or initial charges will be assessed and charged at the time of subscription creation. If the card cannot be successfully charged, the subscription will not be created. See further notes in the section on Importing Subscriptions.'
  stored_credential_transaction_id:
    type: integer
    description: 'For European sites subject to PSD2 and using 3D Secure, this can be used to reference a previous transaction for the customer. This will ensure the card will be charged successfully at renewal.'
  sales_rep_id:
    type: integer
  payment_profile_id:
    type: integer
    description: 'The Payment Profile ID of an existing card or bank account, which belongs to an existing customer to use for payment for this subscription. If the card, bank account, or customer does not exist already, or if you want to use a new (unstored) card or bank account for the subscription, use `payment_profile_attributes` instead to create a new payment profile along with the subscription. (This value is available on an existing subscription via the API as `credit_card` > id or `bank_account` > id)'
  reference:
    type: string
    description: The reference value (provided by your app) for the subscription itelf.
  customer_attributes:
    type: object
    properties:
      first_name:
        type: string
        description: The first name of the customer. Required when creating a customer via attributes.
      last_name:
        type: string
        description: The last name of the customer. Required when creating a customer via attributes.
      email:
        type: string
        description: "\tThe email address of the customer. Required when creating a customer via attributes."
      cc_emails:
        type: string
        description: A list of emails that should be cc’d on all customer communications. Optional.
      organization:
        type: string
        description: The organization/company of the customer. Optional.
      reference:
        type: string
        description: 'A customer “reference”, or unique identifier from your app, stored in Chargify. Can be used so that you may reference your customer’s within Chargify using the same unique value you use in your application. Optional.'
      address:
        type: string
        description: (Optional) The customer’s shipping street address (i.e. “123 Main St.”).
      address_2:
        type: string
        description: (Optional) Second line of the customer’s shipping address i.e. “Apt. 100”
        nullable: true
      city:
        type: string
        description: (Optional) The customer’s shipping address city (i.e. “Boston”).
      state:
        type: string
        description: '(Optional) The customer’s shipping address state (i.e. “MA”). This must conform to the [ISO_3166-1](https://en.wikipedia.org/wiki/ISO_3166-1#Current_codes) in order to be valid for tax locale purposes.'
      zip:
        type: string
        description: (Optional) The customer’s shipping address zip code (i.e. “12345”).
      country:
        type: string
        description: '(Optional) The customer shipping address country, required in [ISO_3166-1 alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2) format (i.e. “US”).'
      phone:
        type: string
        description: (Optional) The phone number of the customer.
      verified:
        type: boolean
      tax_exempt:
        type: boolean
        description: (Optional) The tax_exempt status of the customer. Acceptable values are true or 1 for true and false or 0 for false.
      vat_number:
        type: string
        description: '(Optional) Supplying the VAT number allows EU customer’s to opt-out of the Value Added Tax assuming the merchant address and customer billing address are not within the same EU country. It’s important to omit the country code from the VAT number upon entry. Otherwise, taxes will be assessed upon the purchase.'
  payment_profile_attributes:
    type: object
    description: alias to credit_card_attributes
    properties:
      chargify_token:
        type: string
        description: (Optional) Token received after sending billing informations using chargify.js. This token must be passed as a sole attribute of `payment_profile_attributes` (i.e. tok_9g6hw85pnpt6knmskpwp4ttt)
      id:
        type: integer
      payment_type:
        type: string
      first_name:
        type: string
        description: '(Optional) First name on card or bank account. If omitted, the first_name from customer attributes will be used.'
      last_name:
        type: string
        description: '(Optional) Last name on card or bank account. If omitted, the last_name from customer attributes will be used.'
      masked_card_number:
        type: string
      full_number:
        type: string
        description: 'The full credit card number (string representation, i.e. 5424000000000015)'
      card_type:
        type: string
        description: '(Optional, used only for Subscription Import) If you know the card type (i.e. Visa, MC, etc) you may supply it here so that we may display the card type in the UI.'
        enum:
          - visa
          - master
          - discover
          - american_express
          - diners_club
          - jcb
          - switch
          - solo
          - dankort
          - maestro
          - laser
          - forbrugsforeningen
      expiration_month:
        type:
          - integer
          - string
        description: '(Optional when performing a Subscription Import via vault_token, required otherwise) The 1- or 2-digit credit card expiration month, as an integer or string, i.e. 5'
      expiration_year:
        type:
          - integer
          - string
        description: '(Optional when performing a Subscription Import via vault_token, required otherwise) The 4-digit credit card expiration year, as an integer or string, i.e. 2012'
      billing_address:
        type: string
        description: '(Optional, may be required by your product configuration or gateway settings) The credit card or bank account billing street address (i.e. 123 Main St.). This value is merely passed through to the payment gateway.'
      billing_address_2:
        type: string
        description: Optional) Second line of the customer’s billing address i.e. Apt. 100
        nullable: true
      billing_city:
        type: string
        description: '(Optional, may be required by your product configuration or gateway settings) The credit card or bank account billing address city (i.e. “Boston”). This value is merely passed through to the payment gateway.'
      billing_state:
        type: string
        description: '(Optional, may be required by your product configuration or gateway settings) The credit card or bank account billing address state (i.e. MA). This value is merely passed through to the payment gateway. This must conform to the [ISO_3166-1](https://en.wikipedia.org/wiki/ISO_3166-1#Current_codes) in order to be valid for tax locale purposes.'
      billing_country:
        type: string
        description: '(Optional, may be required by your product configuration or gateway settings) The credit card or bank account billing address country, required in [ISO_3166-1 alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2) format (i.e. “US”). This value is merely passed through to the payment gateway. Some gateways require country codes in a specific format. Please check your gateway’s documentation. If creating an ACH subscription, only US is supported at this time.'
      billing_zip:
        type: string
        description: '(Optional, may be required by your product configuration or gateway settings) The credit card or bank account billing address zip code (i.e. 12345). This value is merely passed through to the payment gateway.'
      current_vault:
        type: string
        description: '(Optional, used only for Subscription Import) The vault that stores the payment profile with the provided vault_token. see additional notes on Braintree Blue'
        enum:
          - authorizenet
          - trust_commerce
          - payment_express
          - beanstream
          - braintree_blue
          - paypal
          - quickpay
          - eway
          - eway_rapid_std
          - stripe_connect
          - pin
          - wirecard
          - bpoint
          - firstdata
          - elavon
          - cybersource
          - paymill
          - moneris
          - litle
          - square
      vault_token:
        type: string
        description: '(Optional, used only for Subscription Import) The “token” provided by your vault storage for an already stored payment profile'
      customer_vault_token:
        type: string
        description: '(Optional, used only for Subscription Import) (only for Authorize.Net CIM storage or Square) The customerProfileId for the owner of the customerPaymentProfileId provided as the vault_token'
      customer_id:
        type: integer
      paypal_email:
        type: string
      payment_method_nonce:
        type: string
        description: (Required for Square unless importing with vault_token and customer_vault_token) The nonce generated by the Square Javascript library (SqPaymentForm)
      gateway_handle:
        type: string
        description: '(Optional) This attribute is only available if MultiGateway feature is enabled for your Site. This feature is in the Private Beta currently. gateway_handle is used to directly select a gateway where a payment profile will be stored in. Every connected gateway must have a unique gateway handle specified. Read [Multigateway description](https://help.chargify.com/payment-gateways/gateway-configuration.html#connecting-with-multiple-gateways) to learn more about new concepts that MultiGateway introduces and the default behavior when this attribute is not passed.'
      cvv:
        type: string
        description: '(Optional, may be required by your gateway settings) The 3- or 4-digit Card Verification Value. This value is merely passed through to the payment gateway.'
      last_four:
        type: string
        description: '(Optional, used only for Subscription Import) If you have the last 4 digits of the credit card number, you may supply them here so that we may create a masked card number (i.e. XXXX-XXXX-XXXX-1234) for display in the UI. Last 4 digits are required for refunds in Auth.Net.'
  bank_account_attributes:
    type: object
    properties:
      chargify_token:
        type: string
      bank_name:
        type: string
        description: (Required when creating a subscription with ACH or GoCardless) The name of the bank where the customer’s account resides
      bank_routing_number:
        type: string
        description: (Required when creating a subscription with ACH. Optional when creating a subscription with GoCardless). The routing number of the bank. It becomes bank_code while passing via GoCardless API
      bank_account_number:
        type: string
        description: (Required when creating a subscription with ACH. Required when creating a subscription with GoCardless and bank_iban is blank) The customerʼs bank account number
      bank_account_type:
        type: string
      bank_branch_code:
        type: string
        description: '(Optional when creating a subscription with GoCardless) Branch code. Alternatively, an IBAN can be provided'
      bank_iban:
        type: string
        description: '(Optional when creating a subscription with GoCardless). International Bank Account Number. Alternatively, local bank details can be provided'
      bank_account_holder_type:
        type: string
      payment_type:
        type: string
  components:
    type: array
    description: '(Optional) An array of component ids and quantities to be added to the subscription. See [Components](https://help.chargify.com/products/product-components.html)  for more information.'
    items:
      type: object
      properties:
        component_id:
          type: integer
        enabled:
          type: boolean
          description: Used for on/off components only
        unit_balance:
          type: integer
          description: Used for metered and events based components
        allocated_quantity:
          type: integer
          description: Used for quantity based compo
        price_point_id:
          type: integer
  calendar_billing:
    type: object
    description: (Optional). Cannot be used when also specifying next_billing_at
    properties:
      snap_day:
        type: integer
        description: 1 - 28 or 'end'
      calendar_billing_first_charge:
        type: string
  metafields:
    type: object
    description: '(Optional) A set of key/value pairs representing custom fields and their values. Metafields will be created “on-the-fly” in your site for a given key, if they have not been created yet.'
    properties:
      color:
        type: string
      comments:
        type: string
  customer_reference:
    type: string
    description: 'The reference value (provided by your app) of an existing customer within Chargify. Required, unless a `customer_id` or a set of `customer_attributes` is given.'
  group:
    $ref: ../models/Group-Attributes.yaml
  ref:
    type: string
    description: 'A valid referral code. (optional, see [Referrals](https://help.chargify.com/referrals/introduction.html) for more details). If supplied, must be valid, or else subscription creation will fail.'
  cancellation_message:
    type: string
    description: (Optional) Can be used when canceling a subscription (via the HTTP DELETE method) to make a note about the reason for cancellation.
  cancellation_method:
    type: string
    description: (Optional) Can be used when canceling a subscription (via the HTTP DELETE method) to make a note about how the subscription was canceled.
  currency:
    type: string
    description: '(Optional) If Multi-Currency is enabled and the currency is configured in Chargify, pass it at signup to create a subscription on a non-default currency. Note that you cannot update the currency of an existing subscription.'
  expires_at:
    type: string
    description: Timestamp giving the expiration date of this subscription (if any). You may manually change the expiration date at any point during a subscription period.
  expiration_tracks_next_billing_change:
    type: string
    description: '(Optional, default false) When set to true, and when next_billing_at is present, if the subscription expires, the expires_at will be shifted by the same amount of time as the difference between the old and new “next billing” dates.'
  agreement_terms:
    type: string
    description: '(Optional) The ACH authorization agreement terms. If enabled, an email will be sent to the customer with a copy of the terms.'
  authorizer_first_name:
    type: string
    description: "\t(Optional) The first name of the person authorizing the ACH agreement."
  authorizer_last_name:
    type: string
    description: (Optional) The last name of the person authorizing the ACH agreement.
  calendar_billing_first_charge:
    type: string
    description: '(Optional) One of “prorated” (the default – the prorated product price will be charged immediately), “immediate” (the full product price will be charged immediately), or “delayed” (the full product price will be charged with the first scheduled renewal).'
  reason_code:
    type: string
    description: (Optional) Can be used when canceling a subscription (via the HTTP DELETE method) to indicate why a subscription was canceled.
  product_change_delayed:
    type: boolean
    description: '(Optional, used only for Delayed Product Change When set to true, indicates that a changed value for product_handle should schedule the product change to the next subscription renewal.'
  offer_id:
    type:
      - string
      - integer
    description: 'Use in place of passing product and component information to set up the subscription with an existing offer. May be either the Chargify id of the offer or its handle prefixed with `handle:`.er'
  prepaid_subscription_configuration:
    $ref: ../models/Create-or-Update-Prepaid-Configuration.yaml
  previous_billing_at:
    type: string
    description: Providing a previous_billing_at that is in the past will set the current_period_starts_at when the subscription is created. It will also set activated_at if not explicitly passed during the subscription import. Can only be used if next_billing_at is also passed. Using this option will allow you to set the period start for the subscription so mid period component allocations have the correct prorated amount.
  import_mrr:
    type: boolean
    description: 'Setting this attribute to true will cause the subscription''s MRR to be added to your MRR analytics immediately. For this value to be honored, a next_billing_at must be present and set to a future date. This key/value will not be returned in the subscription response body.'
  canceled_at:
    type: string
  activated_at:
    type: string